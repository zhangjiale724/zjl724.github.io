<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="富文本框实现图片上传"><meta name="keywords" content="Vue"><meta name="author" content="zjl,undefined"><meta name="copyright" content="zjl"><title>富文本框实现图片上传【zjl】</title><link rel="stylesheet" href="/zjl724.github.io/css/fan.css"><link rel="stylesheet" href="/zjl724.github.io/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/zjl724.github.io/favicon.ico"><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/zjl724.github.io/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/zjl724.github.io/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">zjl</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/zjl724" target="_blank">GitHub<i class="icon-dot bg-color5"></i></a><a class="links-button button-hover" href="mailto:2052649747@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color3"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color1"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/zjl724.github.io/archives"><span class="pull-top">日志</span><span class="pull-bottom">24</span></a><a class="author-info-articles-tags article-meta" href="/zjl724.github.io/tags"><span class="pull-top">标签</span><span class="pull-bottom">15</span></a><a class="author-info-articles-categories article-meta" href="/zjl724.github.io/categories"><span class="pull-top">分类</span><span class="pull-bottom">8</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="title-name" href="/zjl724.github.io/">zjl</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">富文本框实现图片上传</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2020-03-15 | 更新于 2020-03-15</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/zjl724.github.io/categories/Vue/">Vue</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/zjl724.github.io/tags/Vue/">Vue</a></div></div></div><div class="main-content"><ol>
<li>安装</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-quill-editor --save</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在main.js中引入</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import VueQuillEditor  from &#39;vue-quill-editor&#39;</span><br><span class="line">import &#39;quill&#x2F;dist&#x2F;quill.core.css&#39;</span><br><span class="line">import &#39;quill&#x2F;dist&#x2F;quill.snow.css&#39;</span><br><span class="line">import &#39;quill&#x2F;dist&#x2F;quill.bubble.css&#39;</span><br><span class="line"> </span><br><span class="line">Vue.use(VueQuillEditor);</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<ol start="3">
<li>template</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;!-- 图片上传组件辅助--&gt;</span><br><span class="line">      &lt;el-upload</span><br><span class="line">        class&#x3D;&quot;avatar-uploader&quot;</span><br><span class="line">        :action&#x3D;&quot;serverUrl&quot;</span><br><span class="line">        name&#x3D;&quot;img&quot;</span><br><span class="line">        :headers&#x3D;&quot;header&quot;</span><br><span class="line">        :show-file-list&#x3D;&quot;false&quot;</span><br><span class="line">        :on-success&#x3D;&quot;uploadSuccess&quot;</span><br><span class="line">        :on-error&#x3D;&quot;uploadError&quot;</span><br><span class="line">        :before-upload&#x3D;&quot;beforeUpload&quot;&gt;</span><br><span class="line">      &lt;&#x2F;el-upload&gt;</span><br><span class="line">      &lt;quill-editor</span><br><span class="line">        v-model&#x3D;&quot;content&quot;</span><br><span class="line">        ref&#x3D;&quot;myQuillEditor&quot;</span><br><span class="line">        :options&#x3D;&quot;editorOption&quot;</span><br><span class="line">        @change&#x3D;&quot;onEditorChange($event)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;&#x2F;quill-editor&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>js</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  const toolbarOptions &#x3D; [</span><br><span class="line">    [&#39;bold&#39;, &#39;italic&#39;, &#39;underline&#39;, &#39;strike&#39;],    </span><br><span class="line">    [&#123;&#39;header&#39;: 1&#125;, &#123;&#39;header&#39;: 2&#125;],              </span><br><span class="line">    [&#123;&#39;list&#39;: &#39;ordered&#39;&#125;, &#123;&#39;list&#39;: &#39;bullet&#39;&#125;],</span><br><span class="line">    [&#123;&#39;indent&#39;: &#39;-1&#39;&#125;, &#123;&#39;indent&#39;: &#39;+1&#39;&#125;],         </span><br><span class="line">    [&#123;&#39;direction&#39;: &#39;rtl&#39;&#125;],                         </span><br><span class="line">    [&#123;&#39;size&#39;: [&#39;small&#39;, false, &#39;large&#39;, &#39;huge&#39;]&#125;], </span><br><span class="line">    [&#123;&#39;header&#39;: [1, 2, 3, 4, 5, 6, false]&#125;],</span><br><span class="line">    [&#123;&#39;color&#39;: []&#125;, &#123;&#39;background&#39;: []&#125;],       </span><br><span class="line">    [&#123;&#39;font&#39;: []&#125;],</span><br><span class="line">    [&#123;&#39;align&#39;: []&#125;],</span><br><span class="line">    [&#39;link&#39;, &#39;image&#39;],</span><br><span class="line">    [&#39;clean&#39;]</span><br><span class="line"> </span><br><span class="line">  ]</span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        quillUpdateImg: false, &#x2F;&#x2F; 根据图片上传状态来确定是否显示loading动画，刚开始是false,不显示</span><br><span class="line">        content: null,</span><br><span class="line">        editorOption: &#123;</span><br><span class="line">          placeholder: &#39;&#39;,</span><br><span class="line">          theme: &#39;snow&#39;,  &#x2F;&#x2F; or &#39;bubble&#39;</span><br><span class="line">          modules: &#123;</span><br><span class="line">            toolbar: &#123;</span><br><span class="line">              container: toolbarOptions,</span><br><span class="line">              handlers: &#123;</span><br><span class="line">                &#39;image&#39;: function (value) &#123;</span><br><span class="line">                  if (value) &#123;</span><br><span class="line">                    &#x2F;&#x2F; 触发input框选择图片文件</span><br><span class="line">                    document.querySelector(&#39;.avatar-uploader input&#39;).click()</span><br><span class="line">                  &#125; else &#123;</span><br><span class="line">                    this.quill.format(&#39;image&#39;, false);</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        serverUrl: &#39;&#x2F;manager&#x2F;common&#x2F;imgUpload&#39;,  &#x2F;&#x2F; 这里写你要上传的图片服务器地址</span><br><span class="line">        header: &#123;</span><br><span class="line">          &#x2F;&#x2F; token: sessionStorage.token</span><br><span class="line">        &#125; &#x2F;&#x2F; 有的图片服务器要求请求头需要有token</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      onEditorChange(&#123;editor, html, text&#125;) &#123;&#x2F;&#x2F;内容改变事件</span><br><span class="line">        console.log(&quot;---内容改变事件---&quot;)</span><br><span class="line">        this.content &#x3D; html</span><br><span class="line">        console.log(html)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F; 富文本图片上传前</span><br><span class="line">      beforeUpload() &#123;</span><br><span class="line">        &#x2F;&#x2F; 显示loading动画</span><br><span class="line">        this.quillUpdateImg &#x3D; true</span><br><span class="line">      &#125;,</span><br><span class="line"> </span><br><span class="line">      uploadSuccess(res, file) &#123;</span><br><span class="line">        &#x2F;&#x2F; res为图片服务器返回的数据</span><br><span class="line">        &#x2F;&#x2F; 获取富文本组件实例</span><br><span class="line">        console.log(res);</span><br><span class="line">        let quill &#x3D; this.$refs.myQuillEditor.quill</span><br><span class="line">        &#x2F;&#x2F; 如果上传成功</span><br><span class="line">        if (res.code &#x3D;&#x3D; 200 ) &#123;</span><br><span class="line">          &#x2F;&#x2F; 获取光标所在位置</span><br><span class="line">          let length &#x3D; quill.getSelection().index;</span><br><span class="line">          &#x2F;&#x2F; 插入图片  res.url为服务器返回的图片地址</span><br><span class="line">          quill.insertEmbed(length, &#39;image&#39;, res.url)</span><br><span class="line">          &#x2F;&#x2F; 调整光标到最后</span><br><span class="line">          quill.setSelection(length + 1)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.$message.error(&#39;图片插入失败&#39;)</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; loading动画消失</span><br><span class="line">        this.quillUpdateImg &#x3D; false</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F; 富文本图片上传失败</span><br><span class="line">      uploadError() &#123;</span><br><span class="line">        &#x2F;&#x2F; loading动画消失</span><br><span class="line">        this.quillUpdateImg &#x3D; false</span><br><span class="line">        this.$message.error(&#39;图片插入失败&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>注：serverUrl :文件上传地址不能直接写全路径，会出现跨域问题报错。需要在conf/index.js 中 进行配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  dev: &#123;</span><br><span class="line">    &#x2F;&#x2F; Paths</span><br><span class="line">    assetsSubDirectory: &#39;static&#39;,</span><br><span class="line">    assetsPublicPath: &#39;&#x2F;&#39;,</span><br><span class="line">    host: &#39;localhost&#39;, &#x2F;&#x2F; can be overwritten by process.env.HOST</span><br><span class="line">    port: 8088, &#x2F;&#x2F; can be overwritten by process.env.PORT, if port is in use, a free one will be determined</span><br><span class="line">    autoOpenBrowser: true,</span><br><span class="line">    cssSourceMap: true,</span><br><span class="line">    proxyTable: &#123;</span><br><span class="line">      &#39;&#x2F;api&#39;: &#123;</span><br><span class="line">        target: &#39;http:&#x2F;&#x2F;localhost:18080&#x2F;&#39;, &#x2F;&#x2F;设置调用接口域名和端口号别忘了加http</span><br><span class="line">        changeOrigin: true,</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          &#39;^&#x2F;api&#39;: &#39;&#x2F;&#39; &#x2F;&#x2F;这里理解成用‘&#x2F;api’代替target里面的地址，组件中我们调接口时直接用&#x2F;api代替</span><br><span class="line">          &#x2F;&#x2F; 比如我要调用&#39;http:&#x2F;&#x2F;0.0:300&#x2F;user&#x2F;add&#39;，直接写‘&#x2F;api&#x2F;user&#x2F;add’即可 代理后地址栏显示&#x2F;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#39;&#x2F;manager&#39;: &#123;</span><br><span class="line">        target: &#39;http:&#x2F;&#x2F;localhost:18081&#x2F;&#39;,</span><br><span class="line">        changeOrigin: true,</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          &#39;^&#x2F;manager&#39;: &#39;&#x2F;&#39;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>style</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  .ql-editor.ql-blank, .ql-editor &#123;</span><br><span class="line">    height: 350px;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">zjl</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://zjl724.github.io/2020/03/15/%E5%AF%8C%E6%96%87%E6%9C%AC%E6%A1%86%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/">https://zjl724.github.io/2020/03/15/%E5%AF%8C%E6%96%87%E6%9C%AC%E6%A1%86%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zjl724.github.io">zjl</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/zjl724.github.io/2020/03/15/Vuex/"><i class="fas fa-angle-left">&nbsp;</i><span>Vuex</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/zjl724.github.io/2020/03/12/Express%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%BA%94%E5%BA%94%E7%94%A8/"><span>Express的基本应应用</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 By zjl</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/zjl724.github.io/js/copy.js"></script><!--script(src=url)--></body></html>